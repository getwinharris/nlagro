<?php
namespace Opencart\Catalog\Controller\Startup;\n\nclass NnlReferral extends \Opencart\System\Engine\Controller {\n    private const NNL_DB_VERSION = '1.3';\n\n    public function index(): void {\n        $this->runDatabaseUpdates();\n        if (isset($this->request->get['agent'])) {\n            $this->setAgentCookie((int)$this->request->get['agent']);\n        }\n        if (isset($this->request->get['ref'])) {\n            $this->setAgentCookie((int)$this->request->get['ref']);\n        }\n    }\n\n    private function runDatabaseUpdates(): void {\n        $this->load->model('setting/setting');\n        $current_version = $this->model_setting_setting->getValue('nnl_db_version');\n\n        if (version_compare($current_version, self::NNL_DB_VERSION, '<')) {\n            $this->log->write('NNL: Database update required. Current: ' . ($current_version ?: 'None') . ', Target: ' . self::NNL_DB_VERSION);\n            try {\n                if (version_compare($current_version, '1.0', '<')) {\n                    $this->updateToV1();\n                }\n                if (version_compare($current_version, '1.1', '<')) {\n                    $this->updateToV1_1();\n                }\n                if (version_compare($current_version, '1.2', '<')) {\n                    $this->updateToV1_2();\n                }\n                if (version_compare($current_version, '1.3', '<')) {\n                    $this->updateToV1_3();\n                }\n\n                $this->db->query("DELETE FROM `" . DB_PREFIX . "setting` WHERE `code` = 'config' AND `key` = 'nnl_db_version'");\n                $this->db->query("INSERT INTO `" . DB_PREFIX . "setting` SET `store_id` = 0, `code` = 'config', `key` = 'nnl_db_version', `value` = '" . $this->db->escape(self::NNL_DB_VERSION) . "', `serialized` = 0");\n                $this->log->write('NNL: Database update to version ' . self::NNL_DB_VERSION . ' completed successfully.');\n            } catch (\\Exception $e) {\n                $this->log->write('NNL: FATAL DATABASE UPDATE FAILED! Error: ' . $e->getMessage());\n            }\n        }\n    }\n\n    private function updateToV1(): void {\n        // ... (existing V1.0 code) ...\n    }\n\n    private function updateToV1_1(): void {\n        // ... (existing V1.1 code) ...\n    }\n\n    private function updateToV1_2(): void {\n        // ... (existing V1.2 code) ...\n    }\n\n    private function updateToV1_3(): void {\n        $this->log->write('NNL: Applying data seeding for v1.3...');\n\n        // --- Seed Investment Product ---\n        $this->seedInvestmentProduct();\n
        $this->log->write('NNL: Data seeding for v1.3 complete.');\n    }\n
    private function seedInvestmentProduct(): void {\n        $this->seedProduct(\n            'NNL Sprout-Growth Bond',\n            'Invest in a 6-month bond focused on high-yield organic sprouts and spinach. This plan offers a 100% ROI, with monthly profit shares and a full capital refund at the end of the term. By leveraging rapid harvest cycles and high export margins, NNL provides a secure and profitable investment in sustainable agriculture.',\n            'Investment Bonds',\n            10000.00\n        );\n    }\n
    // ... (other existing helper functions) ...\n
}\n